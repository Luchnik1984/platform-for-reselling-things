# Платформа по перепродаже вещей - Бэкенд

##  Описание проекта
REST API сервис для платформы объявлений о продаже вещей. Проект разрабатывается в рамках курсовой работы командой из 3 человек.

##  Текущий статус
Бэкэнд реализован

**Дата:** 2025-12-24

## ✅ Уже реализовано (исходный код)
✅ Этап 1: Написание DTO и контроллеров
- ✅ Sprint 1 - Инфраструктура и DTO
- ✅ Sprint 2 - Контроллеры (с заглушками)
- ✅ Sprint 3 - Интеграция и проверка
####
✅ Этап 2: - Сущности, репозитории, мапперы
- ✅ Sprint 4 - Создание скелета приложения
- ✅ Sprint 5 - Реализация мапперов и тестирование

####
✅ Этап 3: - Авторизация, Аутентификация, сервисы
- ✅ Sprint 6 - Безопасность и базовые сервисы
- ✅ Sprint 7 - Сервисы объявлений и комментариев
- ✅ Sprint 8 - Интеграция и обработка исключений

####
✅ Этап 4: - Работа с изображениями, тестирование
- ✅ Sprint 9 - Расширение ImageService и настройка статических ресурсов
- ✅ Sprint 10 - Тестирование оптимизация


### Инфраструктура
- [x] Spring Boot 2.7.15 проект
- [x] Настроены основные зависимости (pom.xml)
- [x] Swagger/OpenAPI документация
- [x] Главный класс HomeworkApplication

### Безопасность
- [x] Spring Security с Basic Auth
- [x] WebSecurityConfig с CORS настройками
- [x] BasicAuthCorsFilter
- [x] PasswordEncoder (BCrypt)
- [x] InMemoryUserDetailsManager для тестирования

### DTO (Data Transfer Objects)
- [x] `Login.java` - аутентификация
- [x] `Register.java` - регистрация
- [x] `NewPassword.java` - смена пароля
- [x] `User.java` - данные пользователя
- [x] `UpdateUser.java` - обновление профиля
- [x] `Ad.java` - объявление
- [x] `ExtendedAd.java` - детали объявления
- [x] `Ads.java` - список объявлений
- [x] `CreateOrUpdateAd.java` - создание/обновление
- [x] `Comment.java` - комментарий
- [x] `Comments.java` - список комментариев
- [x] `CreateOrUpdateComment.java` - создание/обновление

### Enums
- [x] `Role.java` enum - роли пользователей

### Контроллеры
- [x] `RegController` - /register
- [x] `AuthController.java` - /login
- [x] `UserController.java` - /users/**
- [x] `AdController.java` - /ads/**
- [x] `CommentController.java` - /ads/*/comments/**

### Сущности (Entities)
- [x] `UserEntity.java` - пользователь
- [x] `AdEntity.java` - объявление
- [x] `CommentEntity.java` - комментарий
- [x] `ImageEntity.java` - картинка

## Активные задачи

### В процессе:

## Запланировано:
### Sprint1 - Инфроструктура и DTO:
- **US1.1:** Настройка Swagger/OpenAPI *(Лучник Иван)*
- **US1.2:** DTO паролей и пользователей *(Гребнев Артём)*
- **US1.3:** DTO объявлений *(Лучник Иван)*
- **US1.4:** DTO комментариев *(Шакурова Дарья)*

### Sprint2 - Контроллеры (пока с заглушками)
- **US2.1:** UserController *(Гребнев Артём)*
- **US2.2:** AdController *(Лучник Иван)*
- **US2.3:** CommentController *(Шакурова Дарья)*

### Sprint3 - Интеграция и проверка
- **US3.1:** Проверка эндпоинтов *(Все участники, каждый свои)*
- **US3.2:** Проверка CORS с фронтэндом *(Все участники)*
- **US3.3:** Проверка Postman *(Лучник Иван)*

### Sprint4 - Создание скелета приложения
- **US4.0:** Добавление валидации в контроллеры *(Лучник Иван)*
- **US4.1:** Создание всех Entity с полями и связями *(Лучник Иван)*
- **US4.2:** Создание всех Repository interfaces *(Лучник Иван)*
- **US4.3:** Настройка конфигурации приложения и профилей *(Лучник Иван)*
- **US4.4:** Настройка инфраструктуры БД и миграций *(Гребнев Артём)*
- **US4.5:** Настройка Docker Testcontainers инфраструктуры *(Гребнев Артём)*
- **US4.6:** Создание мапперов (интерфейсы MapStruct) *(Лучник Иван)*

### Sprint5 - Реализация мапперов и тестирование
- **US5.1:** Реализация UserMapper и тесты *(Гребнев Артём)*
- **US5.2:** Реализация и тестирование AdMapper *(Лучник Иван)*
- **US5.3:** Реализация и тестирование CommentMapper *(Шакурова Дарья)*
- **US5.4:** Интеграционные тесты репозиториев *(Шакурова Дарья)*
- **US5.5:** Валидация и проверка соответствия OpenAPI *(Гребнев Артём)*
- **US5.6:** Финальная сборка и документация *(Лучник Иван)*

### Sprint6 - Безопасность и базовые сервисы
- **US6.0:** Создать SecurityUtils *(Лучник Иван)*
- **US6.1:** Настройка Spring Security с JdbcUserDetailsManager *(Гребнев Артём)*
- **US6.2:** Обновление AuthService и RegService для работы с БД *(Гребнев Артём)*
- **US6.3:** Реализация UserService *(Лучник Иван)*
- **US6.4:** Реализация ImageService (базовая) *(Шакурова Дарья)*

### Sprint7 - Сервисы объявлений и комментариев
- **US7.1:** Реализация AdService (часть 1) *(Лучник Иван)*
- **US7.2:** Реализация AdService (часть 2) *(Лучник Иван)*
- **US7.3:** Реализация CommentService *(Шакурова Дарья)*

### Sprint8 - Интеграция и обработка исключений
- **US8.1:** Глобальная обработка исключений *(Гребнев Артём)*
- **US8.2:** Обновление контроллеров UserController, AdController *(Лучник Иван)*
- **US8.3:** Обновление CommentController *(Шакурова Дарья)*

### Sprint9 - Расширение ImageService и настройка статических ресурсов
- **US9.1:** Расширение ImageService для работы с сущностями *(Шакурова Дарья)*
- **US9.2:** Обновление сервисов для использования расширенного ImageService *(Гребнев Артём)*
- **US9.3:** Настройка статического доступа к изображениям *(Лучник Иван)*

### Sprint10 - Тестирование и оптимизация
- **US10.1:** Интеграционные тесты сервисов с Testcontainers *(Лучник Иван)*
- **US10.2:** Интеграционные тесты контроллеров с @SpringBootTest *(Шакурова Дарья)*
- **US10.3:** НUnit-тесты сервисов *(Гребнев Артём)*

### Sprint11 - Оптимизация и рефакторинг
- **US11.1:** Рефакторинг кода *(Гребнев Артём)*
- **US11.2:** Оптимизация запросов *(Лучник Иван)*
- **US11.3:** Логирование и мониторинг *(Шакурова Дарья)*


## Завершено:
- **US1.1:** Настройка Swagger/OpenAPI *(Лучник Иван)*
- **US1.3:** DTO объявлений *(Лучник Иван)*
- **US2.2:** AdController *(Лучник Иван)*
- **US1.2:** DTO паролей и пользователей *(Гребнев Артём)*
- **US1.4:** DTO комментариев *(Шакурова Дарья)*
- **US2.1:** UserController *(Гребнев Артём)*
- **US2.3:** CommentController *(Шакурова Дарья)*
- **US3.2:** Проверка CORS с фронтэндом *(Все участники)*
- **US3.3:** Проверка Postman *(Лучник Иван)*
- **US4.0:** Добавление валидации в контроллеры *(Лучник Иван)*
- **US4.1:** Создание всех Entity с полями и связями *(Лучник Иван)*
- **US4.2:** Создание всех Repository interfaces *(Лучник Иван)*
- **US4.3:** Настройка конфигурации приложения и профилей *(Лучник Иван)*
- **US5.2:** Реализация и тестирование AdMapper *(Лучник Иван)*
- **US4.4:** Настройка инфраструктуры БД и миграций *(Гребнев Артём)*
- **US5.3:** Реализация и тестирование CommentMapper *(Шакурова Дарья)*
- **US5.1:** Реализация UserMapper и тесты *(Гребнев Артём)*
- **US6.0:** Создать SecurityUtils *(Лучник Иван)*
- **US6.3:** Реализация UserService *(Лучник Иван)*
- **US7.1:** Реализация AdService (часть 1) *(Лучник Иван)*
- **US7.2:** Реализация AdService (часть 2) *(Лучник Иван)*
- **US7.3:** Реализация CommentService *(Шакурова Дарья)*
- **US8.2:** Обновление контроллеров UserController, AdController *(Лучник Иван)*
- **US6.1:** Настройка Spring Security с JdbcUserDetailsManager *(Гребнев Артём)*
- **US6.2:** Обновление AuthService и RegService для работы с БД *(Гребнев Артём)*
- **US8.1:** Глобальная обработка исключений *(Гребнев Артём)*
- **US8.3:** Обновление CommentController *(Шакурова Дарья)*
- **US8.2:** Обновление контроллеров UserController, AdController *(Лучник Иван)*
- **US9.1:** Расширение ImageService для работы с сущностями *(Шакурова Дарья)*
- **US9.2:** Обновление сервисов для использования расширенного ImageService *(Гребнев Артём)*
- **US9.3:** Настройка статического доступа к изображениям *(Лучник Иван)*
- **US10.1:** Интеграционные тесты сервисов с Testcontainers *(Лучник Иван)*
- **US10.2:** Интеграционные тесты контроллеров с @SpringBootTest *(Шакурова Дарья)*
- **US10.3:** НUnit-тесты сервисов *(Гребнев Артём)*
- **US11.1:** Рефакторинг кода *(Гребнев Артём)*
- **US11.2:** Оптимизация запросов *(Лучник Иван)*
- **US11.3:** Логирование и мониторинг *(Шакурова Дарья)*

# Запуск проекта
### Требования:
- Java 15 или выше
- Maven 3.6+
- Docker для фронтенда

## Команды:

- Создайте файл настроек окружения.
  Файл содержит настройки подключения к БД и приложения.
  Отредактируйте его
```bash
  cp .env.example .env
```

### Компиляция проекта
```bash
  ./mvnw clean compile 
```

### Запуск приложения

## Разработка с PostgreSQL:
- Вариант A: PostgreSQL в Docker (рекомендуется)
```bash
     docker-compose -f docker-compose.db.yml up -d
```
- Вариант B: Локальная PostgreSQL
- Убедитесь что PostgreSQL установлен и база создана
```bash
./mvnw spring-boot:run
# Запускаем приложение
  $env:SPRING_PROFILES_ACTIVE="dev"
# Устанавливаем профиль
#
```
## Тестирование:

### Unit-тесты (H2)
```bash
   mvn.cmd test -Dgroups="unit"
```
### Интеграционные тесты (Testcontainers + PostgreSQL
```bash
   mvn.cmd test -Dgroups="integration"
```
###  Все тесты
```bash
   ./mvnw test 
```

## Сборка пакета:
```bash
   ./mvnw package 
```

## Запуск фронтэнда:
### Для Windows (PowerShell)
Запустите Docker Desktop, затем выполните в терминале:
```bash
     docker run -p 3000:3000 --rm ghcr.io/dmitry-bizin/front-react-avito:v1.21
```

## Docker Compose для PostgreSQL:

### Запуск PostgreSQL
```bash
     docker-compose -f docker-compose.db.yml up -d
```
### Остановка PostgreSQL
```bash
     docker-compose -f docker-compose.db.yml down
```
### Остановка с удалением данных PostgreSQL
```bash
     docker-compose -f docker-compose.db.yml down -v
```
### Удаление контейнера, созданного docker-compose.db.yml
```bash
     docker-compose -f docker-compose.db.yml down --rmi all
```

## Последовательный запуск приложения с PostgreSQL и фронтендом
- Создайте и отредактируйте файл .env
```bash
    cp .env.example .env
```
- Запустите PostgreSQL в Docker
```bash
     docker-compose -f docker-compose.db.yml up -d
```
- Проверьте что контейнер запущен
```bash
     docker ps | Select-String "postgres"
```
- Запустите приложение с профилем 'dev' для работы с PostgreSQL
```bash
  ./mvnw spring-boot:run
  # Запускаем приложение
  $env:SPRING_PROFILES_ACTIVE="dev"
  # Устанавливаем профиль
#
```
- Запустите Docker Desktop,
  затем выполните в НОВОМ терминале (бэкенд оставьте работать в первом):
```bash
     docker run -p 3000:3000 --rm ghcr.io/dmitry-bizin/front-react-avito:v1.21
```
##  Ссылки
- OpenAPI спецификация: в файле openapi.yaml
- Фронтенд: http://localhost:3000
- GitHub проекта: https://github.com/Luchnik1984/platform-for-reselling-things

## Документация API
- Swagger UI: http://localhost:8080/swagger-ui.html
- OpenAPI JSON: http://localhost:8080/api-docs
- OpenAPI YAML: http://localhost:8080/api-docs.yaml


##  Статистика проекта
- **ЭТАП 1:**
- **Эндпоинты:** 17/17 готово (100%)
- **DTO:** 12/12 готово (100%)
- **Контроллеры:** 5/5 готово (100%)
- **Этап 1:** 10/10 UserStories (100%)

-  **ЭТАП 2:**
- **Сущности:** 4/4 готово (100%)
- **Репозитории (интерфейсы):** 4/4 готово (100%)
- **Мапперы (интерфейсы):** 3/3 готово (100%)
- **Этап 2:** 13/13 UserStories (100%)

-  **ЭТАП 3:**
- **Базовые сервисы:** 6/6 готово (100%)
- **Кастомные исключения:** 6/6 готово (100%)
- **Глобальная обработка исключений** 1/1
- **Этап 3:** 11/11 UserStories (100%)

-  **ЭТАП 4:**
- **Статический доступ к изображениям** +
- **Интеграционные тесты сервисов** +
- **Интеграционные тесты контроллеров** +
- **Unit-тесты сервисов** +
- **Логирование** +
- **Этап 4:** 11/11 UserStories (0%)

##  Технологический стек
- **Java 17**
- **Spring Boot 2.7.15**
- **Spring Security** (Basic Auth)
- **Spring Data JPA**
- **Flywaydb**
- **PostgreSQL**
- **Docker compose**
- **Mapstruct**
- **Docker testcontainers**
- **H2 Database in memory**
- **Lombok** (упрощение кода)
- **SpringDoc OpenAPI**

## Архитектурное решение
[Посмотреть полную диаграмму архитектуры](/architecture.mmd)

### Ключевые компоненты:
1. **Пользовательский интерфейс**
   -	Frontend React - веб-приложение на порту 3000
2. **Безопасность**
   -	Spring Security - аутентификация и авторизация
   -	CORS - межсайтовые запросы
3. **Контроллеры**
   -	RegController -  регистрация
   -    AuthController - вход
   -	UserController - управление профилем
   -	AdController - объявления
   -	CommentController - комментарии
4. **Сервисы**
   -	AuthService - логика аутентификации
   -	UserService - логика пользователей
   -	AdService - логика объявлений
   -	CommentService - логика комментариев
   -	ImageService - работа с картинками
5. **Репозитории** - доступ к данным через Spring Data JPA
   -	UserRepository - доступ к данным пользователей
   -	AdRepository - доступ к данным объявлений
   -	CommentRepository - доступ к данным комментариев
6. **Сущности (Entity)** - отображение таблиц БД в Java-классы
   -	UserEntity - пользователь
   -    AdEntity - объявление
   -    CommentEntity - комментарий
   -    ImageEntity - картинка
7. **База данных**
   -	PostgreSQL - основное хранилище
   -	H2 - тестовая БД
8. **Вспомогательные компоненты**
   -	DTO - объекты для передачи данных
   -	Мапперы - преобразование Entity <--> DTO с помощью MapStruct
   -
#### Поток данных:
Frontend → Security → Controller → Service → Repository → Database


##  Команда
- **Гребнев Артём**
- **Лучник Иван**
- **Шакурова Дарья**